
name: Cron Scrape Normas

on:
  schedule:
    # 6:00 AM and 1:00 PM Peru time (UTC-5)
    # UTC time: 11:00 AM and 6:00 PM
    - cron: '0 11,18 * * *'
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Scrape
        run: |
          if [ -z "${{ secrets.APP_URL }}" ]; then
            echo "Error: APP_URL secret is not set."
            exit 1
          fi
          # Usar -L para seguir redirecciones (importante si hay http->https o trailing slashes)
          # Usar --fail para que falle si el servidor retorna error (4xx/5xx)
          curl -v -L --fail -X POST "${{ secrets.APP_URL }}/api/scrape-normas"